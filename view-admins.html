<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>عرض المسؤولين - MCS</title>
    <link rel="stylesheet" href="control-style.css">
    <style>
        .admins-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .admins-header {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 60px; /* مساحة لزر الخروج */
        }
        
        .admins-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .admin-card {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            position: relative;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .admin-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .admin-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid #ffd700;
            flex-shrink: 0;
        }
        
        .admin-info {
            flex: 1;
            min-width: 0; /* مهم للتعامل مع النصوص الطويلة */
        }
        
        .admin-info h3 {
            margin: 0;
            color: #ffd700;
            word-wrap: break-word;
        }
        
        .admin-info p {
            margin: 5px 0 0;
            opacity: 0.8;
            font-size: 0.9rem;
            word-wrap: break-word;
            direction: ltr;
            text-align: right;
        }
        
        .admin-role {
            display: inline-block;
            background: rgba(255,215,0,0.1);
            color: #ffd700;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin-top: 8px;
            border: 1px solid rgba(255,215,0,0.3);
        }
        
        .role-founder {
            background: rgba(255,0,0,0.1);
            color: #ff6b6b;
            border-color: rgba(255,0,0,0.3);
        }
        
        .floating-add-btn {
            position: fixed;
            bottom: 50px;
            right: 50px;
            width: 60px;
            height: 60px;
            background: #ffd700;
            color: #1e3c72;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            text-decoration: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: transform 0.3s;
            z-index: 1000;
            font-weight: bold;
        }
        
        .floating-add-btn:hover {
            transform: scale(1.1);
            text-decoration: none;
        }
        
        .no-admins {
            text-align: center;
            padding: 40px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            grid-column: 1 / -1;
        }
    </style>
</head>
<body>
    <button class="logout-btn" onclick="logout()">خروج</button>
    
    <div class="admins-container">
        <div class="admins-header">
            <h1>إدارة المسؤولين</h1>
            <p>عرض وتعديل حسابات المسؤولين في النظام</p>
        </div>
        
        <div id="adminsList" class="admins-grid">
            <!-- سيتم ملء المسؤولين هنا -->
        </div>
    </div>
    
    <!-- زر الإضافة العائم -->
    <a href="add-admin.html" class="floating-add-btn">
        <span style="color: #1e3c72; font-size: 28px;">+</span>
    </a>

    <script type="module">
        // تحقق من تسجيل الدخول
        const currentUser = JSON.parse(localStorage.getItem('mcs_user'));
        const isLoggedIn = localStorage.getItem('controlLoggedIn');
        
        if (!currentUser || !isLoggedIn) {
            window.location.href = 'index.html';
        }
        
        // تحقق من الصلاحيات
        const hasPermission = currentUser.permissions && 
            (currentUser.permissions.includes('المؤسس') || 
             currentUser.permissions.includes('إضافة ادمن'));
        
        // إخفاء زر الإضافة إذا لم يكن لديه الصلاحية
        if (!hasPermission) {
            document.querySelector('.floating-add-btn').style.display = 'none';
        }
        
        // استيراد Firebase
        import { db, collection, getDocs } from './firebase-config.js';
        
        async function loadAdmins() {
            try {
                const adminsList = document.getElementById('adminsList');
                adminsList.innerHTML = '<div class="no-admins"><p>جاري تحميل المسؤولين...</p></div>';
                
                // جلب المسؤولين من Firestore
                const querySnapshot = await getDocs(collection(db, "admins"));
                
                if (querySnapshot.empty) {
                    adminsList.innerHTML = '<div class="no-admins"><p>لا يوجد مسؤولين في النظام</p></div>';
                    return;
                }
                
                adminsList.innerHTML = '';
                
                querySnapshot.forEach((doc) => {
                    const admin = doc.data();
                    const adminId = doc.id;
                    
                    const isFounder = admin.permissions && admin.permissions.includes('المؤسس');
                    const roleClass = isFounder ? 'role-founder' : '';
                    const roleText = isFounder ? 'المؤسس' : 'مسؤول';
                    
                    const adminCard = document.createElement('div');
                    adminCard.className = 'admin-card';
                    adminCard.innerHTML = `
                        <div class="admin-header">
                            <img src="${admin.profileImage || 'https://lh3.googleusercontent.com/a/ACg8ocIwrmQ4ZyLhsN0_5rdXUPR-TyQrVexf1h8jwHOzbgVDYhHUYA=s96-c'}" 
                                 alt="${admin.name}" class="admin-avatar"
                                 onerror="this.src='https://lh3.googleusercontent.com/a/ACg8ocIwrmQ4ZyLhsN0_5rdXUPR-TyQrVexf1h8jwHOzbgVDYhHUYA=s96-c'">
                            <div class="admin-info">
                                <h3>${admin.name || 'بدون اسم'}</h3>
                                <p>${admin.email}</p>
                                <span class="admin-role ${roleClass}">${roleText}</span>
                            </div>
                        </div>
                        <div style="margin-top: 15px; font-size: 0.8rem; opacity: 0.7;">
                            <div>تم الإنشاء: ${admin.createdAt ? new Date(admin.createdAt).toLocaleDateString('ar-EG') : 'غير معروف'}</div>
                            ${admin.updatedAt ? `<div>آخر تحديث: ${new Date(admin.updatedAt).toLocaleDateString('ar-EG')}</div>` : ''}
                        </div>
                    `;
                    
                    adminsList.appendChild(adminCard);
                });
                
            } catch (error) {
                console.error('خطأ في تحميل المسؤولين:', error);
                document.getElementById('adminsList').innerHTML = `
                    <div class="no-admins">
                        <p>حدث خطأ في تحميل المسؤولين</p>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // تحميل المسؤولين عند فتح الصفحة
        loadAdmins();
        
        function logout() {
            localStorage.removeItem('controlLoggedIn');
            localStorage.removeItem('loginTime');
            localStorage.removeItem('mcs_user');
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>